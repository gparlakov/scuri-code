name: Test scuri code
pr:
    - master
    - release/*
trigger:
    - master
pool:
    vmImage: 'ubuntu-latest'

variables:
  - name: DISPLAY
    value: :99
steps:
  - name: Checkout
    uses: actions/checkout@v2
    with:
      fetch-depth: 0
  - name: Install xvfb virtual display
    run: sudo apt-get install -y xvfb
  - name: start virtual display
    run: Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &
  - name: Setup Node.js
    uses: actions/setup-node@v1
    with:
      node-version: 12
  - name: Install dependencies
    run: npm ci
  - name: Test
    run: npm run test
  - name: prepare for publish
    run: npm run vscode:prepublish

